#!/usr/bin/env bash
set -eo pipefail

pv --name stores "$STORES_FILE" \
  | sqlite-utils insert "$DB" stores - \
    --nl --pk=locationNumber --replace --alter

pv --name products "$PRODUCTS_FILE" \
  | sqlite-utils insert "$DB" products - \
    --nl --pk=itemNumber --replace --alter

pv --name inventory "$INVENTORY_FILE" \
  | sqlite-utils insert "$DB" inventory - \
    --nl --pk=locationNumber --pk=product__id --replace --alter

sqlite-utils add-foreign-keys "$DB" \
  inventory locationNumber stores locationNumber \
  inventory product__id products itemNumber

sqlite-utils index-foreign-keys "$DB"
sqlite-utils optimize "$DB"
